!!!
%html{:lang => "en"}
  %head
    %title= @topic ? "#{@topic.name} : Leap"  : "Leap"
    = stylesheet_link_tag "//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"
    = stylesheet_link_tag "//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"
    = stylesheet_link_tag  'https://fonts.googleapis.com/css?family=Patua+One'
    = stylesheet_link_tag '//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/css/datepicker3.min.css'
    = stylesheet_link_tag 'cloud'
    = javascript_include_tag "//code.jquery.com/jquery-1.11.0.min.js"
    = javascript_include_tag '//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js'
    = javascript_include_tag 'jquery.peity.min'
    = javascript_include_tag '//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/bootstrap-datepicker.min.js'
    = javascript_include_tag 'cloud_events'
    = csrf_meta_tag
    %meta{:name => "viewport", :content => "width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"}
    = render :partial => "layouts/ganalytics" unless Settings.google_analytics_code.empty? or Rails.env == "development"
  %body#cleap{:class => ([Person.affiliation] + (@courses || []))}
    = render "layouts/top_bar/main"
    .container
      - if @topic
        .row.visible-xs.visible-sm
          .col-xs-12.hidden-clidebar
            %h3{:style => "margin-top:0"}
              = @topic.name
              %small= @topic.mis_id
      .row 
        - if @topic
          #clidebar.col-lg-3.col-md-4.visible-lg.visible-md
            = render :partial => "people/sb_person", :object => @topic
            .btn-group.btn-group-justified.panel
              = link_to(person_timetables_url(@topic), :class => "btn btn-default") do
                %i.fa.fa-fw.fa-calendar
                Timetable
              - if @user.staff?
                = link_to(Settings.ebs_person_base_url + @topic.mis_id.to_s, :class => "btn btn-default") do
                  %i.fa.fa-fw{:class => Settings.ebs_link_icon}
                  = Settings.ebs_link_name
            = render :partial => "people/new_note"
            #sidebar-accordion.panel-group
              - unless @topic.staff?
                .panel.panel-default
                  .panel-heading
                    %h4.panel-title
                      %a{"data-toggle" => "collapse", "data-parent" => "#sidebar-accordion", :href => "#personal-details"}
                        %i.fa.fa-user.fa-fw
                        Personal Details
                  #personal-details.panel-collapse.collapse
                    .panel-body
                      %dl
                        %dt Address
                        %dd= @topic.address_text
                        - unless @topic.home_phone.blank?
                          %dt Home Phone
                          %dd= @topic.home_phone
                        - unless @topic.mobile_number.blank?
                          %dt Mobile Phone
                          %dd= @topic.mobile_number
                        - unless @topic.personal_email.blank?
                          %dt Personal Email
                          %dd= mail_to(@topic.personal_email)
                        - if @topic.date_of_birth 
                          %dt Date of Birth
                          %dd= "#{@topic.date_of_birth.to_date.to_s} (Age: #{@topic.age})"
                        - unless @topic.next_of_kin.blank?
                          %dt Next of Kin
                          %dd= @topic.next_of_kin
                      - if @topic.current_user?
                        .text-right
                          Are your details incorrect?
                          = link_to "Notify Us", Settings.notify_details_change_url, :class => "btn btn-info"
              .panel.panel-default
                .panel-heading
                  %h4.panel-title
                    %a{"data-toggle" => "collapse", "data-parent" => "#sidebar-accordion", :href => "#timeline-links"}
                      %i.fa.fa-clock-o.fa-fw
                      Timeline
                #timeline-links.panel-collapse.collapse.in
                  .panel-body
                    %ul=render @views
              .panel.panel-default
                .panel-heading
                  %h4.panel-title
                    %a{"data-toggle" => "collapse", "data-parent" => "#sidebar-accordion", :href => "#moodle-courses"}
                      %i.fa.fa-graduation-cap.fa-fw
                      Moodle Courses
                #moodle-courses.panel-collapse.collapse
                  .panel-body
                    = link_to("#{Settings.moodle_host}#{Settings.moodle_path}",
                                {:target => Settings.moodle_link_target})  do
                      %h4
                        %i.fa.fa-home
                        Moodle Home
                    #moodle-courses-links
                      %i.fa.fa-circle-o-notch.fa-spin
                      loading...
              - if @sidebar_links
                - tmpid = "custom_links_1"
                - @sidebar_links.each do |menu|
                  .panel.panel-default
                    .panel-heading
                      %h4.panel-title
                        %a{"data-toggle" => "collapse", "data-parent" => "#sidebar-accordion", :href => "##{tmpid}"}
                          %i.fa.fa-fw{:class => menu[1]}
                          = menu[0]
                    .panel-collapse.collapse{:id => tmpid}
                      .panel-body
                        %ul.fa-ul
                          - menu[2].each do |item|
                            %li
                              = link_to item[1] do
                                %i.fa.fa-li{:class => item[2] || "fa-link"}
                                = item[0]
                  - tmpid.next!
        #main-content.col-xs-12{:class => @topic ? ["col-lg-9","col-md-8"] : nil}= yield
        - if @topic and @on_home_page
          = javascript_tag "$('#moodle-courses-links').load('#{moodle_block_person_url(@topic)}')"
          #note-modal.modal.fade
            .modal-dialog
              .modal-content
                .modal-header
                  %h4.modal-title Learner has a note on student records system.
                .modal-body
                  - if Person.user.admin?
                    = simple_format @topic.note
                  - else
                    %p Contact your student records department or Leap admin for more information
                .modal-footer
                  %button.btn.btn-default{"data-dismiss" => "modal"}Close
        #leap-about-modal.modal.fade
          .modal-dialog
            .modal-content
              .modal-header
                %h4.modal-title About Leap
              .modal-body
                .row
                  .col-xs-4.col-xs-offset-4
                    = image_tag "leap-logo.png", :class => "img-responsive"
                .row
                  .col-xs-10.col-xs-offset-1
                    %h4.text-center 
                      Open source individual learning plans
                      %br/
                      %small Copyright 2011&ndash;2014 South Devon College
                .row
                  .col-xs-10.col-xs-offset-1.text-center
                    .btn-group.btn-group-lg
                      = link_to "https://github.com/sdc/leap", :target => "_BLANK", :class => "btn btn-default", :title => "Leap on Github" do
                        %i.fa.fa-fw.fa-github
                      = link_to "https://twitter.com/leapilp", :target => "_BLANK", :class => "btn btn-default", :title => "Leap on Twitter"  do
                        %i.fa.fa-fw.fa-twitter
                      = link_to "https://plus.google.com/+leap-ilp", :target => "_BLANK", :class => "btn btn-default", :title => "Leap on Google+" do
                        %i.fa.fa-fw.fa-google-plus
                      = link_to "mailto:leap@southdevon.ac.uk", :target => "_BLANK", :class => "btn btn-default", :title => "Email us" do
                        %i.fa.fa-fw.fa-envelope
              .modal-footer
                %button.btn.btn-default{"data-dismiss" => "modal"}Close
